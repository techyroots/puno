<!doctype html>
<html>
   <head>
      <meta charset="utf-8">
      <title>::.Forgot Password.::</title>
      <link rel="icon" href="images/logo.ico"  />
      <!--responsive-meta-here-->
      <meta name="viewport" content="minimum-scale=1.0, maximum-scale=1.0,width=device-width, user-scalable=no">
      <meta name="apple-mobile-web-app-capable" content="yes">
      <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
      <!--responsive-meta-end-->
      <link href="css/bootstrap.min.css" rel="stylesheet" />
      <link href="css/fontawesome.min.css" rel="stylesheet"/>
      <link rel="stylesheet" type="text/css" href="css/owl.carousel.min.css" media="screen" />
      <link rel="stylesheet" href="css/style.css" />
      <link rel="stylesheet" href="css/responsive.css">
      <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
      <!-- <link rel="stylesheet" href="css/responsive.css" rel="stylesheet"/> -->
      <style>
        .forgot-box {
            max-width: 400px;
            margin: 0px auto;
            text-align: center;
            padding: 0px 20px;
        }
        .new-password {
            max-width: 400px;
            margin: 0px auto;
            text-align: center;
            padding: 0px 20px;
        }

      </style>
   </head>
   <body>
      <div class="warper ">
         <div class="login-wraper">
           <div class="login-bg"><img src="images/banner-home.png"></div>
           <div class="forgot-box">
             <div class="logo-in-page">
               <a href="index.html">
                 <img src="images/logo.png" style="width: 170px;margin-bottom: 30px;">
               </a>
               <h4>Forgot Password</h4>
             </div>
             <div class="forgot-box-in" id="emailSender">
               <div class="form-group input-site">
                 <input type="text" id="email" placeholder="Email" class="form-control" value="">
                 <span id="email_error" class="text-danger bold" style="display:none"></span>
               </div>
               <div class="text-center">
                 <button class="btn btn-green w-100" onclick = "forgetPassword()">Send Request</button>
               </div>
             </div>
           </div>
            <div class="new-password mt-4" id="passwordNew" style="display:none;">
              <!--<form method="post">-->
                 <div class="row">
                    <div class="col-md-12">
                       <div class="row">
                           <div class="col-md-12">
                             <div class="form-group input-site">
                                <input type="text" id="verify_email" name="" placeholder="Enter Email" class="form-control" readonly>
                             </div>
                           </div>
                           <div class="col-md-12">
                             <div class="form-group input-site">
                                <input type="password" name="" id= "password"  placeholder="New Password" class="form-control">
				<span id="pass_error" class="text-danger bold" style="display:none;"></span>
                             </div>
                          </div>
                          <div class="col-md-12">
                             <div class="form-group input-site">
                                <input type="password" name="" id="confirmpassword" placeholder="Confirm New Password" class="form-control">
				<span id="confirmPass_error" class="text-danger bold" style="display:none;"></span>
                             </div>
                          </div>
                          <div class="col-md-12">
                             <div class="form-group input-site">
                                <input type="number" name="" id="vrify-otp"  placeholder="Enter OTP" class="form-control">
				<span id="otp_error" class="text-danger bold" style="display:none;"></span>
                             </div>
                          </div>
                          <div class="col-md-12">
                             <button class="btn btn-green" onclick = "forget_password_verify()">Update password</button>
                          </div>
                       </div>
                    </div>
                 </div>
              <!--</form>-->
           </div>
         </div>
      </div>
   </body>
   <script src="js/jquery.min.js" type="text/javascript"></script>
   <script src="js/bootstrap.min.js" type="text/javascript"></script>
   <script type="text/javascript" src="js/owl.carousel.min.js"></script>
   <script src="https://kit.fontawesome.com/184e8709aa.js" crossorigin="anonymous"></script>
   <script type="text/javascript">
    $(window).scroll(function(){var body=$("body"),scroll=$(window).scrollTop();if(scroll>=5)body.addClass("fixed");else body.removeClass("fixed");});
    
    function forgetPassword() {
        let emailID = document.getElementById("email").value;
	let emailIDVal  = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        let emailIDTrue = emailIDVal.test(emailID);
	if(emailIDTrue){
            document.getElementById('email_error').style.display = "none";
            document.getElementById('email_error').innerHTML = "";
            var settings = {
          	"url": "http://puno.finance:5000/api/forget_password_get_otp",
          	"method": "POST",
          	"timeout": 0,
          	"headers": {
            		"Content-Type": "application/x-www-form-urlencoded"
          	},
          	"data": {
            		"email": document.getElementById("email").value
         	 }
       	    };
            $.ajax(settings).done(function (response) {
     		     if(response.success == true){
               		swal(response.msg, {button:false, icon:"success", timer:1000});
               		document.getElementById("verify_email").value = document.getElementById("email").value;
               		setTimeout(function(){
                   		 document.getElementById("passwordNew").style.display = 'block';
                    		document.getElementById("emailSender").style.display = 'none';
              		 }, 2000)
          	    }else{
              		swal(response.msg, {button:false, icon:"error", timer:1000})
         	    }
       	    });
	}else{
		 document.getElementById('email_error').style.display = "block";
     	         if(emailID == "")document.getElementById('email_error').innerHTML = "** Fill this field";
          	 else document.getElementById('email_error').innerHTML = "** Email is invalid.";
	}
    }

    function forget_password_verify() {
        let email = document.getElementById("verify_email").value;
        let password = document.getElementById("password").value;
        let re_password = document.getElementById("confirmpassword").value;
        let otp = document.getElementById("vrify-otp").value;
        let passVal = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@#$^!%*?&_])[A-Za-z\d@#$^!%*?&_]{8,}$/;
        passValTrue = passVal.test(password);
        if(passValTrue){
            document.getElementById('pass_error').style.display = "none";
            document.getElementById('pass_error').innerHTML = "";
        }else{
            document.getElementById('pass_error').style.display = "block";
            if(password == "")document.getElementById('pass_error').innerHTML = "** Fill this field";
            else document.getElementById('pass_error').innerHTML = "**Password must contain Minimum eight characters, at least one uppercase letter, one lowercase letter, one number and one special character";
            return ;
        }
        if(re_password == ""){
            document.getElementById('confirmPass_error').style.display = "block";
           document.getElementById('confirmPass_error').innerHTML = "** Fill this field";
           return;
        }
        else{
            document.getElementById('confirmPass_error').style.display = "none";
            document.getElementById('confirmPass_error').innerHTML = "";
        }
        if(otp == ""){
            document.getElementById('otp_error').style.display = "block";
           document.getElementById('otp_error').innerHTML = "** Fill this field";
           return;
        }
        else{
            document.getElementById('otp_error').style.display = "none";
            document.getElementById('otp_error').innerHTML = "";
        }
	console.log(email, password, re_password, otp);
        var settings = {
          "url": "http://puno.finance:5000/api/forget_password_verify_otp",
          "method": "POST",
          "timeout": 0,
          "headers": {
            "Content-Type": "application/x-www-form-urlencoded"
          },
          "data": {
            "email": email,
            "password" : password,
	    "re_password" : re_password,
	    "otp" :otp,
          }
        };
        $.ajax(settings).done(function (response) {
          if(response.success == true){
               swal(response.msg, {button:false, icon:"success", timer:1000});
               
               setTimeout(function(){
                    window.location.href = "http://puno.finance/login.html";
               }, 2000)
          }else{
              swal(response.msg, {button:false, icon:"error", timer:1000})
          }
        });
    }
    
   </script>
</html>
